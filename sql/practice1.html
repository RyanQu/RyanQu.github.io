<!DOCTYPE html>
<html lang="EN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SQL Practice</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.59.1/codemirror.min.css" />
    <!--[if lt IE 9]>
      <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
      body { 
        padding-top: 70px; 
      }
      .navbar-brand { margin-left: 6px; }
      .code-pre { 
        margin-bottom: 0px; 
        -webkit-border-radius: 0;
        -moz-border-radius: 0;
        border-radius: 0;
      }
      .remove-round {
        -webkit-border-radius: 0;
        -moz-border-radius: 0;
        border-radius: 0;
      }
      .code-box {
        border: 1px;
      }
      .result {
        border: 1px;
      }
      .db_model {
        width: 100%;
      }
      pre.prettyprint {
        background-color: #eee;
      }
      .kwd {
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">SQL Practice For MIS</a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li><a href="index.html">Introduction</a></li>
            <li><a href="class.html">Class</a></li>
            <li class="active"><a href="practice1.html">Practice 1<span class="sr-only">(current)</span></a></li>
            <li><a href="practice2.html">Practice 2</a></li>
            <li><a href="#" title="Not Available Now" data-toggle="tooltip" data-placement="bottom">Exam</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://ryanqu.com">Powered by Yuan Qu</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="row">
      <div class="container">
        <h1>The Database Model</h1>
        <img src="practice1.png" alt="" class="db_model img-thumbnail">
        <p id="db_status">The databse and all the tables are created.</p>
        <p>First, you could use <code>SHOW tables;</code> to check the existing tables, and then <code>SELECT * FROM ...</code> to see the data records.</p>
        <p>Note that the field <code>UnitsOnOrder</code> in the <code>products</code> table is the product’s total number of units on order from suppliers, whereas the <code>Quantity</code> field in <code>products_orders</code> tables indicates the number of units of a product in a particular customer order. The <code>ProductUnitPrice</code> field in the <code>product</code> table is the price charged to customers. The <code>OrderDate</code> field in the <code>orders</code> table contains only a date, not a specific time of day.</p>
        <h3>Questions:</h3>
        <p><strong>Q1. </strong>The operations group has requested report showing, for each product, the difference between the number of units in stock and the reorder level; in particular, negative values of this difference indicate products that need to be reordered. To satisfy their request, write a SQL query that shows the name of each product, the unit price, the number of units in stock, the reorder level, and the difference between the units in stock and reorder level (named “UnitStatus”). Sort the results alphabetically by product name. 
          <button type="button" class="btn btn-link btn-sm" data-toggle="modal" data-target="#q1_modal"> Desired Result</button>
        </p>
        
        <p><strong>Q2. </strong>The HR department is preparing for the “employee of the week” event, and has asked for a list of sales reps, showing each sales rep’s total number of orders logged in the week of <code>2021-01-15</code>. Create a query that shows each sales rep’s total number of orders for the week <code>2021-01-15</code> ~ <code>2021-01-22</code> (named “TotalOrders”), the sale rep’s ID, and their full name. Order the output by the total number of orders, largest first.<button type="button" class="btn btn-link btn-sm" data-toggle="modal" data-target="#q2_modal"> Desired Result</button></p>
        <div class="alert alert-danger" role="alert">Use <code>`TotalOrderAmount`</code> instead of <code>TotalOrderAmount</code> in your query, an unexpected error may occur here. </div>
        
        <p><strong>Q3. </strong>The accounting department would like to determine the value of inventory currently on order from suppliers, itemized by product. Create a query that shows the name of each product, its unit price, the number of units on order from suppliers, and the total dollar value of the units on order (called “ValueOnOrder”). Products which currently have zero units on order from suppliers should not appear in the query output. The value of each unit on order is considered to be the same as the corresponding ProductUnitPrice charged to customers.<button type="button" class="btn btn-link btn-sm" data-toggle="modal" data-target="#q3_modal"> Desired Result</button></p>
        <p><strong>Q4: </strong>In order to identify “slow moving” products, the marketing department would like report a showing all products that have accumulated $1000 or less in total customer orders. Create a query that shows, for each such product, the product ID, the product name, and the total value of customer orders. Products which have never been ordered by customers do not have to appear in the query output.<button type="button" class="btn btn-link btn-sm" data-toggle="modal" data-target="#q4_modal"> Desired Result</button></p>

        <div class="modal fade" id="q1_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Q1</h5>
              </div>
              <div class="modal-body" id="q1"></div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>

        <div class="modal fade" id="q2_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Q2</h5>
              </div>
              <div class="modal-body" id="q2"></div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>

        <div class="modal fade" id="q3_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Q3</h5>
              </div>
              <div class="modal-body" id="q3"></div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>

        <div class="modal fade" id="q4_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Q4</h5>
              </div>
              <div class="modal-body" id="q4"></div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="container">
        <div class="border col-md-4">
          <h4>Input your SQL code here:</h4>
          <form>
            <div class="form-group">
              <textarea id="sql" class="form-control">SELECT * FROM customers;</textarea>
              <button type="button" class="btn btn-primary" onclick="execute_sql()">Submit</button>
            </div>
          </form>
        </div>
        <div class="col-md-8">
          <h4>Result of your query:</h4>
          <div class="border" id="result">
            <table class="table table-striped table-bordered table-hover">
              <tr>
                <th></th>
                <th></th>
              </tr>
              <tr>
                <td></td>
                <td></td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/alasql/0.2/alasql.min.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.59.1/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.59.1/mode/sql/sql.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js?lang=sql"></script>
    <script>
      var editor = CodeMirror.fromTextArea(document.getElementById("sql"), {
        lineNumbers: true,
        lineWrapping: true,
        mode: "sql"
      });
      $(".CodeMirror-scroll").hover(function(){
          $(this).get(0).style.cursor = "text";
      });
      $(function () {
        $('[data-toggle="tooltip"]').tooltip()
      });
    </script>
    <script>
      var tm = Date.now();
      var db = new alasql.Database();
      alasql.options.errorlog = true;
      $.get('practice1.sql', function(data) {
        document.getElementById('db_status').innerHTML = "The database is successfully loaded!";
        data.split(';').forEach(function (sql) {
          sql = sql.trim();
          if (sql) {
            db.exec(sql);
          };
        });

        var q_sql = [
          "SELECT ProductName, ProductUnitPrice, UnitsInStock, ReorderLevel, (UnitsInStock-ReorderLevel) AS UnitStatus FROM products ORDER BY ProductName ASC;", 
          "SELECT COUNT(OrderID) AS TotalOrders, O.SalesRepID, FirstName, LastName FROM orders AS O, sales_reps AS S WHERE O.SalesRepID = S.SalesRepID AND OrderDate BETWEEN '2021-01-15' AND '2021-01-22' GROUP BY O.SalesRepID, FirstName, LastName ORDER BY COUNT(OrderID) DESC;",
          "SELECT ProductName, ProductUnitPrice, UnitsOnOrder, ROUND(UnitsOnOrder*ProductUnitPrice, 2) AS `ValueOnOrder` FROM products WHERE UnitsOnOrder > 0;", 
          "SELECT O.ProductID, P.ProductName, ROUND(SUM(Quantity*UnitPrice),2) AS `TotalOrderAmount` FROM products AS P, products_orders AS O WHERE P.ProductID=O.ProductID GROUP BY O.ProductID, P.ProductName HAVING SUM(Quantity*UnitPrice) <= 1000;"
        ];

        for (var i=0;i<q_sql.length;i++){
          sql = q_sql[i].trim();
          try{res = db.exec(sql);}
          catch(err){console.log(err)}
          document.getElementById('q'+(i+1).toString()).innerHTML = display_table(res);
        };
      }, 'text');
      
      function display_table(res) {
        var s = '';
        s += '<table class="table table-striped table-bordered table-hover">';
        s += '<tr>';
        for (key in res[0]) {
          s += '<th>' + key + '</th>';
        };
        s += '</tr>';
        res.forEach(function (row) {
          s += '<tr>';
          for (key in row) {
              s += '<td>' + (typeof row[key] == 'undefined' ? '' : row[key]) + '</td>';
          };
          s += '</tr>';
        });
        s += '</table>';
        return s
      };
      function execute_sql() {
        var s = '';
        var sqls = editor.getValue();
        sqls.split(';').forEach(function (sql) {
          sql = sql.trim();
          if (sql) {
            try{
              var res = db.exec(sql);
            }
            catch(err){
              document.getElementById('result').innerHTML = err;
            }
            s += display_table(res);
          };
        })
        document.getElementById('result').innerHTML = s;
      };
    </script>
    <script>
      
    </script>
  </body>
</html>